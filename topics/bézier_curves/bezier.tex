% Copyright © 2017, Evpok Padding <evpok.padding@gmail.com>
%
% Permission is granted to Do What The Fuck You Want To
% with this document.
%
% See the WTF Public License, Version 2 as published by Sam Hocevar
% at http://wtfpl.net if you need more details.

\RequirePackage{xparse}
% Settings
\NewDocumentCommand\myname{}{Evpok Padding}
\NewDocumentCommand\mylab{}{University of Procrastinatown}
\NewDocumentCommand\pdftitle{}{On Bézier curves}
\NewDocumentCommand\mymail{}{evpok.padding@gmail.com}
\NewDocumentCommand\titlepagetitle{}{\pdftitle}
\NewDocumentCommand\docdate{}{\today}
\NewDocumentCommand\pageheadertitle{}{\pdftitle}

%%%% Type de document %%%%
\documentclass[a4paper, 11pt]{article}

% Paper properties
\usepackage{parskip}	% Space between paragraphs instead of indentation

\usepackage{polyglossia}
	\setmainlanguage{english}
	\setotherlanguage{french}


%%%% Packages %%%%%
\usepackage{fontspec}
	% Polices de caractères, voir aussi dans les troublesome packages (unicode-math)
	\setmainfont[Ligatures=TeX]{Linux Libertine O}
	\setsansfont[Ligatures=TeX]{Linux Biolinum O}

\usepackage{luacode}
\usepackage{metalogo}
\usepackage{luatexbase}
%
\usepackage{amsfonts,amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{mathtools}	% AMS Maths service pack
	\newtagform{brackets}{[}{]}	% Pour des lignes d'équation numérotées entre crochets
	\mathtoolsset{showmanualtags, mathic}	% affiche les tags manuels (\tag et \tag*) et corrige le kerning des maths inline dans un bloc italique voir la doc de mathtools
	\usetagform{brackets}	% Utilise le style de tags défini plus haut

\usepackage{lualatex-math}

\usepackage{siunitx}
	\sisetup{locale=FR,inter-unit-product=\ensuremath{{}\cdot{}}}
\usepackage{enumitem}	% Pour de belles énumérations
\usepackage{booktabs}	% Pour de beaux tableaux

\usepackage{bbm}	% Gras de tableau pour tous!
\usepackage{faktor} 	% Structures quotient
\usepackage{xspace}	% Pour une gestion propre des espaces
\usepackage{esvect}	% Pretty vector arrows
\usepackage{microtype}
\usepackage{mleftright}	% Pour avoir des délimiteurs de taille variable correctement espacés
\usepackage{fancyvrb}	% Pour de beaux verbatims
\usepackage{caption, subcaption}	% Pour des sous-figures
\usepackage{ccicons}	% Pour les licences Creative Commons
\usepackage[section]{placeins}	% Restreindre les `floats` à leur section
\usepackage{multicol}
	\setlength\columnsep{2em}
\usepackage{tabu}
	\tabulinesep=1mm
\usepackage{listings}
	\lstset{basicstyle=\ttfamily}
\usepackage{csquotes}	% Localised quotation marks

\usepackage[totpages,user]{zref}

% À activer si besoin
% Bibliographie, style alphabétique, références retour et suggestion de saut de ligne après les blocs.
\usepackage[backend=biber, style=alphabetic, backref=true, block=ragged, autopunct, maxnames=6]{biblatex}
	\defbibheading{bibliography}[\refname]{\section*{#1}}

%%% TikZ %%%
% À activer au besoin
% Si on active l'externalisation, penser à créer un dossier tikzpics/
% dans le même dossier que le .tex comme tikz ne sait visiblement pas
% le créer tout seul
\usepackage{xcolor}
\usepackage{tikz}	% Pour les dessins
% 	\usetikzlibrary{arrows}
% 	\usetikzlibrary{shapes}
%
% 	\usepgflibrary{fpu}
% 	\usetikzlibrary{calc}

\usepackage{todonotes}

% Define a TikZ node for math content:
% \NewDocumentCommand{\mathnode}{O{}mm}{\tikz[remember picture, baseline=(#2.base), inner sep = 0pt]{\node[#1] (#2) {$\displaystyle #3$};}}

%%%% Troublesome packages %%%%
% Ceux-ci ont tendance à mettre le bazar, on les appelle en dernier

%%%% csquotes Config %%%%
\NewDocumentCommand\bigopenquote{O{“}}{
	\tikz[remember picture, overlay, xshift=-1.5em, yshift=-1em, text=gray] \node (OQ) {\fontsize{60pt}{60pt}\selectfont#1};
}
% for commands `\blockquote` and related:
\renewcommand{\mkblockquote}[4]{\bigopenquote\em\relax#1\em\relax#2\newline\relax---\,#4#3}
% for environments `\displayquote` and related:
\renewcommand{\mkbegdispquote}[2]{\openautquote\begin{emphasize}}
\renewcommand{\mkenddispquote}[2]{\end{emphasize}\closeautoquote#1\newline\relax---\,#2}

% Use emphasis for foreign (text) quotes
\makeatletter
    \renewcommand{\mktextquote}[6]{%
        #1%
        \iflanguage{\xpg@main@language}{}{\em}%
        #2#4#3#6#5%
        \em%
    }
\makeatother

%%%% Maths unicode %%%%
% À charger après tous les autres packages de maths
\usepackage[math-style=french]{unicode-math} % 'nuf said
	\setmathfont{XITS Math}
\usepackage{newunicodechar}
	\newunicodechar{√}{\sqrt}


%%%% Plot functions using TikZ %%%%
% Apparently still has to be loaded after unicode-math despite http://tex.stackexchange.com/a/227857/8547
% \usepackage{pgfplots}
% 	\pgfplotsset{compat=1.12}

%%%% Liens hypertexte et pdf stuff %%%%
\usepackage{hyperxmp}	% XMP metadata
\usepackage[backref,pagebackref=false,hyperindex=true,bookmarks=true,hypertexnames=false]{hyperref}
\hypersetup{	% Config d'hyperref
    pdfencoding=auto,	% détection d'encodage
    colorlinks=true,	% colorise les liens
    breaklinks=true,	% permet le retour à la ligne dans les liens trop longs
    urlcolor= blue,	% couleur des hyperliens
    linkcolor= red,	% couleur des liens internes
    pdfdisplaydoctitle=true,	% Titre au lieu de nom de fichier,
    unicode=true,
    bookmarksopen=true,	% si les signets Acrobat sont créés, les afficher complètement.
    pdftitle={\pdftitle},	% informations apparaissant dans
    pdfauthor={\myname <\mymail>},	% dans les informations du document
    pdflang={fr},	% langue du document
    pdfsubject={},	% sous  les lecteurs modernes
    pdfcopyright={Copyright © \the\year, \myname},
    % pdflicenseurl={http://wtfpl.net},	% The url of your licence
    pdfcontactemail={\mymail},
}
%
%%%% License %%%%
\usepackage[type={CC},modifier={zero},version={1.0}]{doclicense}

%%%% PDF bookmarks %%%%
% Profondeur allant jusqu'au paragraphe
\usepackage[depth=paragraph]{bookmark}


%%%% Références intelligentes %%%%
% http://tex.stackexchange.com/a/285953/8547
\usepackage{nameref}
\usepackage{cleveref}
\let\globcount\newcount
\usepackage{autonum}	% N'afficher que les numéros d'équations référencées
%
%%% Définition des  théorèmes %%%%
% Custom `amsthm` proof style. Has to be put here, since
% `thmtools` patches the `proof` environment itself
\makeatletter
    \renewenvironment{proof}[1][\proofname]{
        \par
        \pushQED{\qed}
        \normalfont \topsep6\p@\@plus6\p@\relax
        \trivlist
        \item\relax
        {\bfseries#1}\newline\ignorespaces
    }{
        \popQED\endtrivlist\@endpefalse
    }
\makeatother

\usepackage{thmtools} % Gestion avancée des théorèmes
	\renewcommand\listtheoremname{Table des théorèmes} % Traduction
	% Pour avoir la commande \thbookmark qui ajoute le théorème en pdf bookmark
	% voir [cette Q&A sur TeX SE](http://tex.stackexchange.com/q/123447/8547)
	\makeatletter
		\NewDocumentCommand\thlabel{m}{
			\thmt@thmname\space\@nameuse{the#1}
		    \ifx\@currentlabelname\@empty
		    \else
		        \space(\@currentlabelname)%
		    \fi
		}
		\NewDocumentCommand\thbookmark{}{\bookmark[dest=\@currentHref,rellevel=1,keeplevel,]{\thlabel{\thmt@envname}}}
	\makeatother

\declaretheoremstyle[postheadspace=\newline,headpunct={},spaceabove=1em,spacebelow=1em]{thstyle}
\declaretheoremstyle[postheadspace=\newline,headpunct={},spaceabove=1em,spacebelow=1em,shaded={rulecolor=black, rulewidth=.2pt, bgcolor=white}]{mainth}

	\declaretheorem[numberwithin=section,style=mainth,
	name=Proposition,refname={proposition,propositions},Refname={Proposition,Propositions}]{prop}
	\declaretheorem[sibling=prop,style=mainth,name=Theorem,refname={Theorem,Theorems},Refname={Theorem,Theorems},postheadhook={\thbookmark}]{theo}
	\declaretheorem[sibling=prop,style=thstyle,name=Lemme,refname={le lemme,les lemmes},
	Refname={Le lemme,Les lemmes}]{lem}
	\declaretheorem[sibling=prop,style=thstyle,name=Corollary,refname={corollary,corollaries},Refname={corollary,corollaries}]{cor}
	\declaretheorem[sibling=prop,style=thstyle,name=Remark,Refname={Remark,Remarks}]{req}
	\declaretheorem[sibling=prop,style=mainth,name=Définition,refname={la définition,les définitions},Refname={La définition,Les définitions},postheadhook={\thbookmark}]{df}
	\declaretheorem[sibling=prop,style=thstyle,name=Exemple,refname={l'exemple,les exemples},Refname={L'exemple,Les exemples}]{ex}
	\declaretheorem[sibling=prop,style=thstyle,name=Convention,refname={la convention,les conventions},
	Refname={La convention,Les conventions}]{conv}
	\declaretheorem[sibling=prop,style=thstyle,name=Méthode,refname={la méthode,les méthodes},
	Refname={La méthode, Les méthodes}]{met}
	\declaretheorem[sibling=prop,style=thstyle,name=Exercice,refname={l'exercice,les exercices},
	Refname={L'exercice, Les exercices}]{exo}

	\declaretheorem[numbered=no,style=mainth,name=Théorème,refname={le théorème,les théorèmes},Refname={Le théorème,Les théorèmes},postheadhook={\thbookmark}]{theo*}
	\declaretheorem[numbered=no,style=mainth,name=Définition,refname={la définition,les définitions},Refname={La définition,Les définitions},postheadhook={\thbookmark}]{df*}
	\declaretheorem[numbered=no,style=mainth,name=Proposition,refname={la proposition,les propositions},Refname={La proposition,Les propositions}]{prop*}
	\declaretheorem[numbered=no,style=thstyle,name=Lemme,refname={le lemme,les lemmes},
	Refname={Le lemme,Les lemmes}]{lem*}
	\declaretheorem[numbered=no,style=thstyle,name=Convention,refname={la convention,les conventions},Refname={La convention,Les conventions}]{conv*}
	\declaretheorem[numbered=no,style=thstyle,name=Méthode,refname={la méthode,les méthodes},
	Refname={La méthode, Les méthodes}]{met*}

%%%% Déclaration des macros %%%%
\DeclareMathOperator\dif{\mathrm{d}}	% Opérateur différentiel
\NewDocumentCommand\newtderiv{m}{\frac{\dif}{\dif #1}}

\DeclareMathOperator{\cotan}{cot} % Cotangente
\DeclareMathOperator{\arccotan}{arccot} % Arccotangente

\DeclareMathOperator{\sh}{sh} % sinus hyperbolique
\DeclareMathOperator{\ch}{ch} % cosinus hyperbolique

\DeclareMathOperator{\Var}{Var}	% Variance

% Notations élaborées %
\DeclareMathOperator*{\smallo}{\omicron}	% Landau notation. With an omicron. Because I like that.
\newunicodechar{ο}{\smallo} 	% That's an omicron (U+03BF)

\NewDocumentCommand\classC{mm}{\mathcal{C}^{#1}\mleft(#2\mright)}

\DeclareMathOperator{\Expectation}{E}	% Espérance
\NewDocumentCommand\Ex{m}{\Expectation\mleft(#1\mright)}

\DeclarePairedDelimiter\norm{\lVert}{\rVert}	% Norme
\DeclarePairedDelimiter\abs{\lvert}{\rvert}	% Valeur absolue
\DeclarePairedDelimiter\nnorm{⦀}{⦀}	% Norme d'opérateur
\DeclarePairedDelimiter\discseg{⟦}{⟧}	% Intervalle discret

\DeclarePairedDelimiterX\compset[2]{\lbrace}{\rbrace}{#1\,\delimsize|\,#2}	% Compréhension d'ensemble
\NewDocumentCommand\comp{m}{\prescript{c}{}{#1}}

% Projectors
\DeclareMathOperator\projector{π}
\NewDocumentCommand\parproj{oo}{
	\IfNoValueTF{#1}{
		\projector
	}{
		\IfNoValueTF{#2}{
			\projector_{#1}
		}{
			\projector_{#1, ∥#2}
		}
	}
}
\NewDocumentCommand\orthproj{o}{
	\IfNoValueTF{#1}{
		\projector^{⊥}
	}{
		\projector_{#1}^{⊥}
	}
}

% Easy colum vectors \vcord{a,b,c} ou \vcord[;]{a;b;c}
% Here be black magic
\ExplSyntaxOn
	\NewDocumentCommand{\vcord}{O{,}m}{\vector_main:nnnn{p}{\\}{#1}{#2}}
	\NewDocumentCommand{\tvcord}{O{,}m}{\vector_main:nnnn{psmall}{\\}{#1}{#2}}
	\seq_new:N\l__vector_arg_seq
	\cs_new_protected:Npn\vector_main:nnnn #1 #2 #3 #4{
		\seq_set_split:Nnn\l__vector_arg_seq{#3}{#4}
		\begin{#1matrix}
			\seq_use:Nnnn\l__vector_arg_seq{#2}{#2}{#2}
		\end{#1matrix}
	}
\ExplSyntaxOff

% Function restriction
\NewDocumentCommand\restr{mm}{{#1_{\mkern 1mu \vrule height 1ex\mkern2mu_{#2}}}}

% la famille des #1 indice #2 pour #2 appartenant à #3
\NewDocumentCommand\fami{mmm}{\left(#1_{#2} \right)_{#2 ∈ #3}}
% la famille des #1 indice #2 pour #2 allant de #3 à #4
\NewDocumentCommand\famii{mmmm}{\fami{#1}{#2}{\discseg*{#3,#4}}}

% la fonction #1, de #2 dans #3 qui à #4 associe #5
\NewDocumentCommand\fonct{mmmmm}{
	\left|\begin{array}{rrl}
	    #1 :  & #2 & ⟶ #3 \\
			  & #4 & ⟼ #1\mleft(#4\mright) = #5
	\end{array}\right.
}

%%% Page header and footer style.  %%%%
\usepackage{titleps}
	\newpagestyle{main}[\small]{
		\sethead{}{\ifnum\thepage>1 {\pageheadertitle}\fi}{}
		\setfoot{}{\ifnum\ztotpages>1 {\thepage\ /\ztotpages}\fi}{}
	}
	\pagestyle{main}


\title{\titlepagetitle}
\author{}
\date{\docdate}

%%%% Commandes spécifiques au document %%%%



% ██████   ██████   ██████ ██    ██ ███    ███ ███████ ███    ██ ████████
% ██   ██ ██    ██ ██      ██    ██ ████  ████ ██      ████   ██    ██
% ██   ██ ██    ██ ██      ██    ██ ██ ████ ██ █████   ██ ██  ██    ██
% ██   ██ ██    ██ ██      ██    ██ ██  ██  ██ ██      ██  ██ ██    ██
% ██████   ██████   ██████  ██████  ██      ██ ███████ ██   ████    ██



\begin{document}
\pagenumbering{arabic}
\pdfbookmark[1]{Cover}{cover}
\maketitle
\thispagestyle{main}

\section{Formal definition}

\section{Tightest bounding box}
A natural question when drawing Bézier curves is “Howmuch space will it take ?”.
Of course, we know from \todo{above} that it is contained in the convex hull of its control points, but that is not necessarily the tightest bounding box there is — see for instance \cref{fig|tightcurve}

\begin{figure}
\centering
\missingfigure[figwidth=6cm]{Testing a long text string}
\caption{A Bézier curve that does not take all of its control polygonal}
\label{fig|tightcurve}
\end{figure}

First, let us find out how far from the line $(P₀P₃)$ the curve extends.
What we want, then is the maximum distance $d_{max}=d(B, (P₀P₃))$ between a $B$, a point of the curve and $(P₀P₃)$.
Let then $M$ be the midpoint of $[P₀P₁]$\footnote{We could chose any other point, but it gives a nicer symmetry this way.}
We have
\begin{align}
	d\mleft(B, (P₀P₃)\mright)
		&= d\mleft(\vv{MB}, ℝ\vv{P₀P₁}\mright)\\
		&= \norm*{\vv{MB} - π\mleft(\vv{MB}\mright)}	&& \text{Where $π$ is the orthogonal projector on $ℝ\vv{P₀P₁}$}\\
\end{align}
Now, using the parametrisation\todo{Parametrisation for $t∈[-1,1]$}\footnote{Again, its symmetry will give us a nicer final expression.}, we have for all $t∈[-1, 1]$
\begin{align}
	\vv{MB(t)} - π\mleft(\vv{MB(t)}\mright)
		&=\left[β_{0,3}(t)\vv{MP₀} +β_{1,3}(t)\vv{MP₁} + β_{2,3}(t)\vv{MP₂} + β_{3,3}(t)\vv{MP₃}\right]\\
		&\phantom{=}-\left[β_{0,3}(t)\vv{MP₀} + β_{1,3}(t)π\mleft(\vv{MP₁}\mright) + β_{2,3}(t)π\mleft(\vv{MP₂}\mright) + β_{3,3}(t)\vv{MP₃}\right]\\
		&= \frac{3}{8}(1-t)²(1+t)\underbrace{\left[\vv{MP₁} - π\mleft(\vv{MP₁}\mright)\right]}_{p₁} + \frac{3}{8}(1-t)(1+t)²\underbrace{\left[\vv{MP₂} - π\mleft(\vv{MP₂}\mright)\right]}_{p₂}\\
		&= \frac{3}{8}(1-t)(1+t)\left[(1-t)p₁ + (1+t)p₂\right]\\
		&= \frac{3}{8}(1-t²)\left[(1-t)p₁ + (1+t)p₂\right]\\
\end{align}

Now $p₁$ and $p₂$ are both orthogonal to $\vv{P₀P₁}$, so, since we work in a plane, they are colinear, and thus, there exists $λ∈ℝ$ such that $p₂=λp₁$, we have

\begin{align}
		\vv{MB(t)} - π\mleft(\vv{MB(t)}\mright)
			&= \frac{3}{8}(1-t²)\left[(1-t)p₁ + (1+t)λp₁\right]\\
			&= \frac{3}{8}(1-t²)\left[(1-t) + λ(1+t)\right]p₁\\
			&= \frac{3}{8}(1-t²)\left[(λ-1)t + (λ+1)\right]p₁
\end{align}

and thus

\begin{equation}
	\norm*{\vv{MB(t)} - π\mleft(\vv{MB(t)}\mright)}
		= \frac{3}{8}(1-t²)\abs*{(λ-1)t + (λ+1)}\norm{p₁}
\end{equation}

We will now have to study several cases depending on $λ$.

\subsection{Case 1: $λ=1$}
This is the easiest case.
It occurs whenever $p₁=p₂$, i.e., when $P₁$ and $P₂$ are on the same side and at the same distance of $(P₀P₃)$. In that case,

\begin{equation}
	\norm*{\vv{MB(t)} - π\mleft(\vv{MB(t)}\mright)}
		= \frac{3}{4}(1-t²)\norm{p₁}
\end{equation}
which is obviously maximal for $t=0$, and thus,
\begin{equation}
	\boxed{d_{max} = \frac{3}{4}\norm{p₁}}
\end{equation}

\subsection{Case 2: $λ=-1$}
This occurs if $p₁=-p₂$, i.e., when $P₁$ and $P₂$ are at the same distance but on opposite sides of $(P₀P₃)$. In that case
\begin{equation}
	\norm*{\vv{MB(t)} - π\mleft(\vv{MB(t)}\mright)}
		= \frac{3}{4}(1-t²)\abs{t}\norm{p₁}
\end{equation}
which is maximal for $t=±\frac{√{3}}{2}$ and thus
\begin{equation}
	\boxed{d_{max} = \frac{√{3}}{2}\norm{p₁}}
\end{equation}
which is incidentally the square root of $d_max$ if $λ=1$.
This is probably no happenstance, but I couldn't find a satisfying justification.
\end{document}
